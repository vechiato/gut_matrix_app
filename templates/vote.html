{% extends "base.html" %}

{% block title %}
Vote
{% endblock %}


{% block content %}
    <h1>Vote</h1>
    <h2>Topics</h2>
    <ul>
        <!-- Iterate over topics and render them -->
        {% for topic in topics %}
            <li><a href="/vote?topic_id={{ topic.id }}">{{ topic.name }}</a></li>
        {% endfor %}
    </ul>
    
    <!-- Display selected topic and its items -->
    {% if selected_topic %}
        <h2>Items for {{ selected_topic.name }}</h2>
        <form method="post">
            <input type="hidden" name="topic_id" value="{{ selected_topic.id }}">
            <ul>
                {% for item in items %}
                    <li>
                        <h3>{{ item.name }}</h3>
                        <label for="gravity_{{ item.id }}">Gravity:</label>
                        <input type="number" name="gravity_{{ item.id }}" id="gravity_{{ item.id }}" min="1" max="5" value="{{ user_votes[item.id].gravity if item.id in user_votes else '' }}" onchange="calculatePriority({{ item.id }})">
                        <label for="urgency_{{ item.id }}">Urgency:</label>
                        <input type="number" name="urgency_{{ item.id }}" id="urgency_{{ item.id }}" min="1" max="5" value="{{ user_votes[item.id].urgency if item.id in user_votes else '' }}" onchange="calculatePriority({{ item.id }})">
                        <label for="tendency_{{ item.id }}">Tendency:</label>
                        <input type="number" name="tendency_{{ item.id }}" id="tendency_{{ item.id }}" min="1" max="5" value="{{ user_votes[item.id].tendency if item.id in user_votes else '' }}" onchange="calculatePriority({{ item.id }})">
                        <span id="priority_{{ item.id }}"></span>
                        <script>
                            // Calculate and display priority score on page load
                            calculatePriority({{ item.id }});
                        </script>
                    </li>
                {% endfor %}
            </ul>
            <button type="submit">Submit Votes</button>
        </form>
    {% endif %}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Loop through each item to calculate and display priority score
            {% for item in items %}
                calculatePriority({{ item.id }});
            {% endfor %}
        });
    
        function calculatePriority(itemId) {
            var gravity = parseInt(document.getElementById('gravity_' + itemId).value);
            var urgency = parseInt(document.getElementById('urgency_' + itemId).value);
            var tendency = parseInt(document.getElementById('tendency_' + itemId).value);
            var priority = gravity * urgency * tendency;
            document.getElementById('priority_' + itemId).innerText = 'Priority: ' + priority;
        }
    </script>
{% endblock %}
