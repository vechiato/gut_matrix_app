{% extends "base.html" %}

{% block title %}
Add Item
{% endblock %}

{% block content %}
    <h2>Add Item</h2>
    <form action="/add_item" method="post">
        <label>Topic:</label><br>
        <select name="topic_id" id="topicSelect">
            {% for topic in existing_topics %}
                <option value="{{ topic.id }}">{{ topic.name }}</option>
            {% endfor %}
        </select><br><br>
        
        <label>New Item Name:</label><br>
        <input type="text" name="name"><br><br>
        
        <input type="submit" value="Add Item">
        
        <br><br>
        <label>Current Items:</label><br>
        <ul id="itemList">
            <!-- JavaScript will populate this list -->
        </ul><br><br>
    
    </form>

    <script>
        // Function to fetch and populate current items for the default topic
        function populateItemsForDefaultTopic() {
            var defaultTopicId = document.getElementById("topicSelect").value;
            // AJAX request to fetch current items for the default topic
            fetch('/get_items?topic_id=' + defaultTopicId)
                .then(response => response.json())
                .then(data => {
                    var itemList = document.getElementById("itemList");
                    itemList.innerHTML = ''; // Clear previous items
                    data.forEach(function(item) {
                        var listItem = document.createElement("li");
                        listItem.textContent = item.name;
                        itemList.appendChild(listItem);
                    });
                });
        }

        // Call the function when the page is first loaded
        populateItemsForDefaultTopic();

        // Add event listener for topic selection change
        document.getElementById("topicSelect").addEventListener("change", function() {
            // Call the function when the topic selection changes
            populateItemsForDefaultTopic();
        });
    </script>
{% endblock %}
